name: Algorithmic Performance Comparison

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  benchmark:
    name: Comparison Profiling
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Get CPU Hardware Info
      run: |
        MODEL=$(lscpu | grep "Model name" | cut -d':' -f2 | xargs)
        echo "CPU_MODEL=$MODEL" >> $GITHUB_ENV

    - name: Compile Both Algorithms
      run: |
        g++ -O3 -std=c++11 -march=native -ffast-math -fomit-frame-pointer heap_perm.cpp -o heap_test -pthread
        g++ -O3 -std=c++11 -march=native -ffast-math -fomit-frame-pointer permpure_full.cpp -o pure_test -pthread

    - name: Execute and Capture Results
      id: run_tests
      run: |
        # Run Heap's Algorithm
        ./heap_test > heap_raw.txt
        cat heap_raw.txt # Display in console for debugging
        TIME_HEAP=$(grep "EXECUTION_TIME" heap_raw.txt | cut -d':' -f2 | xargs)
        echo "TIME_HEAP=$TIME_HEAP" >> $GITHUB_ENV
        
        # Run Position-Pure Algorithm
        ./pure_test > pure_raw.txt
        cat pure_raw.txt # Display in console for debugging
        TIME_PURE=$(grep "EXECUTION_TIME" pure_raw.txt | cut -d':' -f2 | xargs)
        echo "TIME_PURE=$TIME_PURE" >> $GITHUB_ENV

    - name: Generate Combined Summary Report
      run: |
        echo "### ðŸš€ Algorithmic Comparison Report (N=12)" >> $GITHUB_STEP_SUMMARY
        echo "| Algorithm | Complexity | Execution Time | Status |" >> $GITHUB_STEP_SUMMARY
        echo "| :--- | :--- | :--- | :--- |" >> $GITHUB_STEP_SUMMARY
        echo "| Heap's Permutation | O(n!) | \`${{ env.TIME_HEAP }} s\` | Baseline |" >> $GITHUB_STEP_SUMMARY
        echo "| **Position-Pure** | **O(n!)** | **\`${{ env.TIME_PURE }} s\`** | **Optimized** |" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "#### ðŸ’» Hardware Environment" >> $GITHUB_STEP_SUMMARY
        echo "- **CPU Model:** ${{ env.CPU_MODEL }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Platform:** Ubuntu (GitHub Cloud)" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "> **Note:** The complexity for both is mathematically \$O(n!)\$. Position-Pure shows better performance due to reduced constant factors and improved cache locality." >> $GITHUB_STEP_SUMMARY
