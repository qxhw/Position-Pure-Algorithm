name: Heap Permutation Benchmark

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  benchmark:
    name: Build and Profile
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Get Hardware Info
      id: cpu_info
      run: |
        CPU_MODEL=$(lscpu | grep "Model name" | cut -d':' -f2 | sed 's/^[ \t]*//')
        echo "CPU_MODEL=$CPU_MODEL" >> $GITHUB_ENV

    - name: Compile heap_perm.cpp
      run: g++ -O3 -std=c++11 heap_perm.cpp -o heap_perm_test -pthread

    - name: Run and Capture Performance
      run: |
        # Use /usr/bin/time -f to get exactly what we want: the elapsed seconds
        # Redirecting algorithm output to /dev/null
        /usr/bin/time -f "%e" ./heap_perm_test > /dev/null 2> time_output.txt
        
        EXEC_TIME=$(cat time_output.txt)
        
        # Create a beautiful Markdown Summary
        echo "### ðŸš€ Algorithmic Performance Report" >> $GITHUB_STEP_SUMMARY
        echo "| Detail | Information |" >> $GITHUB_STEP_SUMMARY
        echo "| :--- | :--- |" >> $GITHUB_STEP_SUMMARY
        echo "| **Algorithm** | Heap's Permutation (Iterative) |" >> $GITHUB_STEP_SUMMARY
        echo "| **Target Size (N)** | 12 |" >> $GITHUB_STEP_SUMMARY
        echo "| **Execution Time** | \`${EXEC_TIME}s\` |" >> $GITHUB_STEP_SUMMARY
        echo "| **CPU Architecture** | ${{ env.CPU_MODEL }} |" >> $GITHUB_STEP_SUMMARY
        echo "| **Optimization** | G++ -O3 (Standard CI) |" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "âœ… *Benchmark completed in cloud environment.*" >> $GITHUB_STEP_SUMMARY

    - name: Display Result in Console
      run: |
        echo "Benchmark finished. Check the 'Summary' tab for the full report."
