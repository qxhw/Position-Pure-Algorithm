name: Heap Permutation Benchmark

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  run-heap-perm:
    name: Build and Benchmark Heap's Algorithm
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Hardware Diagnostics (CPU Info)
      # Using '|| true' to prevent exit code 1 if a string is not found
      run: |
        echo "========== Hardware Environment =========="
        lscpu | grep "Model name" || true
        lscpu | grep "CPU MHz" || true
        echo "------------------------------------------"
        echo "Full LSCPU Output for Reference:"
        lscpu
        echo "=========================================="

    - name: Compile heap_perm.cpp
      run: g++ -O3 heap_perm.cpp -o heap_perm_test

    - name: Execution and Performance Profiling
      # If your code requires manual input, it might hang. 
      # I added 'echo 10 |' as a placeholder to prevent hanging if cin is used.
      run: |
        echo "Starting performance profiling..."
        echo 10 | time ./heap_perm_test > /dev/null
        echo "Profiling completed."
